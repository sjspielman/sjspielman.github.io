<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Stephanie J. Spielman</title>
      <meta name="viewport" content="width=device-width">

      <!-- Custom CSS -->
      <link rel="stylesheet" href="/css/main.css">

       <!-- syntax highlighting CSS -->
       <link rel="stylesheet" href="/css/schemes/zenburn.css">
      
      <!-- Responsive CSS -->
      <link rel="stylesheet" href="/css/responsive.css">

      <!-- Google Fonts -->
      <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>
      <link href='http://fonts.googleapis.com/css?family=Raleway:300,400,700' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div class="site">
      <div class="sidebar" id="sidebar">
        <div class="header">
          <h1 class="title"><a href="/"><img id="logo" src="/images/me.jpg"></a></h1>
          <span class="tagline">Stephanie J. Spielman</span>
        </div>
        <div class="footer">
          <span id="footer-links">
            <a href="mailto:" class="footer-link">Email</a> <span class="separator">&bull;</span>
            <a href="https://www.github.com/sjspielman" class="footer-link">Github</a> <span class="separator">&bull;</span>
            <a href="https://www.twitter.com/stephspiel" class="footer-link">Twitter</a>
          </span>
        </div>
                
        <div class="posts">
          <ul class="side-list">
              <li>
                <a class="side-title" href="/">
                  Home
                </a>
                <h1 class="peptide"><a href="/peptide/"><img id="logo" src="/images/peptide.png"></a></h1>
              </li>
              <li>
                <a class="side-title" href="/publications/">
                  Publications
                </a>
                <h1 class="peptide"><a href="/peptide/"><img id="logo" src="/images/peptide.png"></a></h1>
              </li>
              <li>
                <a class="side-title" href="/preprints/">
                  Preprints
                </a>
                <h1 class="peptide"><a href="/peptide/"><img id="logo" src="/images/peptide.png"></a></h1>
              </li>
              <li>
                <a class="side-title" href="/teaching/">
                  Teaching
                </a>
                <h1 class="peptide"><a href="/peptide/"><img id="logo" src="/images/peptide.png"></a></h1>
              </li>
              <li>
                <a class="side-title" href="/software/">
                  Software
                </a>
                <h1 class="peptide"><a href="/peptide/"><img id="logo" src="/images/peptide.png"></a></h1>
              </li>


          </ul>
        </div>
      </div>
        <div class="content" id="home">
  <div id="sidebar-button">
    <img src="/images/sidebar-button.png">
  </div>
  <div id="post-info">
    <div id="info-container">
      <h1 id="title">Announcing Pyvolve!</h1>
      <br><br>
    </div>
  </div>

  <div class="post">
    <p>Today, the preprint for my new software, <a href="http://sjspielman.org/pyvolve">Pyvolve</a> was <a href="http://dx.doi.org/10.1101/020214">published on biorXiv</a>! Pyvolve is an open-source Python module for simulating sequences along phylogenies. A comprehensive user-manual for Pyvolve is available with the most recent release from this <a href="https://github.com/sjspielman/pyvolve">github repository</a>.</p>

<!--more-->

<p>Pyvolve is written in pure Python, with dependencies of NumPy, SciPy, and Biopython. The Pyvolve framework is extremely flexible, allowing you to simulate sequences according to virtually all standard models of nucleotide, amino acid, and codon data, and you can customize <em>all</em> model parameters to your heart&#39;s content. Further, Pyvolve allows you to provide a custom rate matrix, if the available models are not quite what you&#39;re looking for (however, please feel free to get in touch with me if you would like to request that a new model be included!). </p>

<p>Pyvolve incorporates both site and temporal heterogeneity, and, as you&#39;ll see in the preprint linked above, contains several novel simulation features. Below, I show some simple examples of Pyvolve simulations. In general, sequence simulations require several you to do a few things:</p>

<ul>
<li>Specify a phylogeny (with branch lengths!)</li>
<li>Define any evolutionary model(s) to use. In Pyvolve, these are <strong>Model</strong> objects.</li>
<li>Assign model(s) to partition(s). In Pyvolve, these are <strong>Partition</strong> objects.</li>
<li>Evolve, using the callable <strong>Evolver</strong> class.</li>
</ul>

<p><br></p>

<p>Partitions are essentially a convenient way of defining &quot;domains&quot; -- each partition can evolve according to a distinct evolutionary model (provided that all partitions evolve the same state, e.g. nucleotides, amino acids, or codons), and each partition can have differing degrees of heterogeneity. </p>

<p>Examples shown below are minimal and do not capture the full power of Pyvolve -- to really see what Pyvolve can do, have a look at the <a href="https://github.com/sjspielman/pyvolve/raw/master/user_manual/pyvolve_manual.pdf">user manual</a>!</p>

<h2>Simulating nucleotide sequences</h2>

<p>This simple example demonstrates how to evolve nucleotide sequences.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyvolve</span>

<span class="c"># Define a phylogeny, from a file containing a newick tree</span>
<span class="n">my_tree</span> <span class="o">=</span> <span class="n">pyvolve</span><span class="o">.</span><span class="n">read_tree</span><span class="p">(</span><span class="nb">file</span> <span class="o">=</span> <span class="s">&quot;file_with_tree.tre&quot;</span><span class="p">)</span>

<span class="c"># Define a nucleotide model, as a Model object.</span>
<span class="n">my_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s">&quot;nucleotide&quot;</span><span class="p">)</span>

<span class="c"># Assign the model to a Partition. The size argument indicates to evolve 250 positions</span>
<span class="n">my_partition</span> <span class="o">=</span> <span class="n">Partition</span><span class="p">(</span><span class="n">models</span> <span class="o">=</span> <span class="n">my_model</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">250</span><span class="p">)</span>

<span class="c"># Evolve!</span>
<span class="n">my_evolver</span> <span class="o">=</span> <span class="n">Evolver</span><span class="p">(</span><span class="n">partitions</span> <span class="o">=</span> <span class="n">my_partition</span><span class="p">,</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">my_tree</span><span class="p">)</span>
<span class="n">my_evolver</span><span class="p">()</span></code></pre></div>

<p><br>
The code shown above will simulate a nucleotide alignment of 250 positions along the phylogeny provided in <code>file_with_tree.tre</code>. This code simulates nucleotides according to default parameters: mutation rates among nucleotides are equal, and nucleotide equilibrium frequencies are equal at 0.25 each. We can customize these parameters by adding a <em>second argument to Model</em>: a dictionary of parameters to customize. </p>

<p>To customize mutation rates, we can use the key <code>&quot;mu&quot;</code>. This key should have an associated value of a dictionary of mutation rates. Mutation rates are symmetric, denotated by keys <code>&quot;AT&quot;</code>, <code>&quot;AC&quot;</code>, etc. (where &quot;AT&quot; is the rate from A to T, and conversely T to A). To customize frequencies, we can use the key <code>&quot;state_freqs&quot;</code>, whose associated value should be a list/numpy array of frequencies ordered ACGT. </p>

<p>This code chunk simulates nucleotide sequences with customized parameters:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyvolve</span>

<span class="c"># Define a phylogeny, from a file containing a newick tree</span>
<span class="n">my_tree</span> <span class="o">=</span> <span class="n">pyvolve</span><span class="o">.</span><span class="n">read_tree</span><span class="p">(</span><span class="nb">file</span> <span class="o">=</span> <span class="s">&quot;file_with_tree.tre&quot;</span><span class="p">)</span>

<span class="c"># Define a nucleotide model with custom parameters!</span>
<span class="n">mutation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;AC&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s">&quot;AG&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s">&quot;AT&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&quot;CG&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s">&quot;CT&quot;</span><span class="p">:</span> <span class="mf">0.99</span><span class="p">,</span> <span class="s">&quot;GT&quot;</span><span class="p">:</span> <span class="mf">1.56</span><span class="p">}</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">]</span> <span class="c"># f(A) = 0.25, f(C) = 0.3, etc.</span>
<span class="n">my_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s">&quot;nucleotide&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;mu&quot;</span><span class="p">:</span> <span class="n">mutation</span><span class="p">,</span> <span class="s">&quot;state_freqs&quot;</span><span class="p">:</span> <span class="n">frequencies</span><span class="p">}</span> <span class="p">)</span>

<span class="c"># Assign the model to a Partition.</span>
<span class="n">my_partition</span> <span class="o">=</span> <span class="n">Partition</span><span class="p">(</span><span class="n">models</span> <span class="o">=</span> <span class="n">my_model</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">250</span><span class="p">)</span>

<span class="c"># Evolve!</span>
<span class="n">my_evolver</span> <span class="o">=</span> <span class="n">Evolver</span><span class="p">(</span><span class="n">partitions</span> <span class="o">=</span> <span class="n">my_partition</span><span class="p">,</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">my_tree</span><span class="p">)</span>
<span class="n">my_evolver</span><span class="p">()</span></code></pre></div>

<p>For those of you who, like myself, tend towards some minor, completely socially-acceptable laziness, you can alternatively specify mutation rates with simply the key <code>&quot;kappa&quot;</code>, which represents the transition-to-transversion bias. Here&#39;s how to define such a model:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Define a nucleotide model kappa</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">]</span> <span class="c"># f(A) = 0.25, f(C) = 0.3, etc.</span>
<span class="n">my_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s">&quot;nucleotide&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;kappa&quot;</span><span class="p">:</span> <span class="mf">3.25</span><span class="p">,</span> <span class="s">&quot;state_freqs&quot;</span><span class="p">:</span> <span class="n">frequencies</span><span class="p">}</span> <span class="p">)</span></code></pre></div>

<p><br>
Now we&#39;re cookin&#39;! Let&#39;s add some more bells and whistles, like <em>rate heterogeneity</em>. In the simulations shown above, all positions evolve according to exactly the same model and the same rate. We can incorporate rate heterogeneity by adding a few <em>keyword arguments</em> when defining our Model object. In this example, we will specify rate heterogeneity with a custom distribution, although as you&#39;ll see in the <a href="https://github.com/sjspielman/pyvolve/raw/master/user_manual/pyvolve_manual.pdf">user manual</a>, you can also specify that rates be distribution according to a gamma distribution.</p>

<p>To implement rate heterogeneity (this holds for nucleotide and amino-acid models!), you need to specify the <em>scalar factors</em> which govern the heterogeneity, and a list of <em>probabilities</em> associated with each factor. This list will determine the probability that a given site evolves according to the associated factor. (Note that if you don&#39;t specify these probabilties, each category will be equally likely).</p>

<p>Let&#39;s go ahead and add in four rate categories, some slow and some fast, with associated probabilities. Specify a list of rate factors with the argument <code>rate_factors</code>, and specify a list of probabilities with the argument <code>rate_probs</code> (should sum to 1!). These lists are associated 1:1, as in the first item in <code>rate_factors</code> will have a probability equal to the first item in <code>rate_probs</code>.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyvolve</span>

<span class="c"># Define a phylogeny, from a file containing a newick tree</span>
<span class="n">my_tree</span> <span class="o">=</span> <span class="n">pyvolve</span><span class="o">.</span><span class="n">read_tree</span><span class="p">(</span><span class="nb">file</span> <span class="o">=</span> <span class="s">&quot;file_with_tree.tre&quot;</span><span class="p">)</span>

<span class="c"># Define our parameters</span>
<span class="n">mutation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;AC&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s">&quot;AG&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s">&quot;AT&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&quot;CG&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s">&quot;CT&quot;</span><span class="p">:</span> <span class="mf">0.99</span><span class="p">,</span> <span class="s">&quot;GT&quot;</span><span class="p">:</span> <span class="mf">1.56</span><span class="p">}</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">]</span> <span class="c"># f(A) = 0.25, f(C) = 0.3, etc.</span>

<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">]</span> <span class="c"># Two fast categories, and two slow categories</span>
<span class="n">probs</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">]</span>  <span class="c"># The fast rates will occur with relatively low probabilities</span>

<span class="c"># Define our model with all parameters</span>
<span class="n">my_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s">&quot;nucleotide&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;mu&quot;</span><span class="p">:</span> <span class="n">mutation</span><span class="p">,</span> <span class="s">&quot;state_freqs&quot;</span><span class="p">:</span> <span class="n">frequencies</span><span class="p">},</span> <span class="n">rate_factors</span> <span class="o">=</span> <span class="n">factors</span><span class="p">,</span> <span class="n">rate_probs</span> <span class="o">=</span> <span class="n">probs</span><span class="p">)</span>

<span class="c"># Assign the model to a Partition.</span>
<span class="n">my_partition</span> <span class="o">=</span> <span class="n">Partition</span><span class="p">(</span><span class="n">models</span> <span class="o">=</span> <span class="n">my_model</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">250</span><span class="p">)</span>

<span class="c"># Evolve!</span>
<span class="n">my_evolver</span> <span class="o">=</span> <span class="n">Evolver</span><span class="p">(</span><span class="n">partitions</span> <span class="o">=</span> <span class="n">my_partition</span><span class="p">,</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">my_tree</span><span class="p">)</span>
<span class="n">my_evolver</span><span class="p">()</span></code></pre></div>

<p>By default, Pyvolve outputs several files:
+ simulated_alignment.fasta
+ site_rates.txt
+ site_rates_info.txt</p>

<p>The first file contains the simulated alignment, and the latter two files contain information about site-specific rates and/or parameters. Using these two files, you can determine at which rate each site evolved. </p>

<p><br> And finally, one more example - what if we wanted to use <em>multiple models</em> in our simulation? For this task, we&#39;ll need to define multiple Partition objects. In the example below, one Partition object will be assigned default parameters, and one Partition will be assigned custom parameters.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyvolve</span>

<span class="c"># Define a phylogeny, from a file containing a newick tree</span>
<span class="n">my_tree</span> <span class="o">=</span> <span class="n">pyvolve</span><span class="o">.</span><span class="n">read_tree</span><span class="p">(</span><span class="nb">file</span> <span class="o">=</span> <span class="s">&quot;file_with_tree.tre&quot;</span><span class="p">)</span>

<span class="c"># Define default model</span>
<span class="n">model1</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s">&quot;nucleotide&quot;</span><span class="p">)</span>

<span class="c"># Define customized model</span>
<span class="n">mutation</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;AC&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s">&quot;AG&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s">&quot;AT&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&quot;CG&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s">&quot;CT&quot;</span><span class="p">:</span> <span class="mf">0.99</span><span class="p">,</span> <span class="s">&quot;GT&quot;</span><span class="p">:</span> <span class="mf">1.56</span><span class="p">}</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">]</span> <span class="c"># f(A) = 0.25, f(C) = 0.3, etc.</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s">&quot;nucleotide&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;mu&quot;</span><span class="p">:</span> <span class="n">mutation</span><span class="p">,</span> <span class="s">&quot;state_freqs&quot;</span><span class="p">:</span> <span class="n">frequencies</span><span class="p">},</span> <span class="n">rate_factors</span> <span class="o">=</span> <span class="n">factors</span><span class="p">,</span> <span class="n">rate_probs</span> <span class="o">=</span> <span class="n">probs</span><span class="p">)</span>

<span class="c"># Assign each model to a Partition.</span>
<span class="n">partition1</span> <span class="o">=</span> <span class="n">Partition</span><span class="p">(</span><span class="n">models</span> <span class="o">=</span> <span class="n">model1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">partition2</span> <span class="o">=</span> <span class="n">Partition</span><span class="p">(</span><span class="n">models</span> <span class="o">=</span> <span class="n">model2</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>

<span class="c"># Evolve, provided both partitions in a list to Evolver</span>
<span class="n">my_evolver</span> <span class="o">=</span> <span class="n">Evolver</span><span class="p">(</span><span class="n">partitions</span> <span class="o">=</span> <span class="p">[</span><span class="n">partition1</span><span class="p">,</span> <span class="n">partition2</span><span class="p">],</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">my_tree</span><span class="p">)</span>
<span class="n">my_evolver</span><span class="p">()</span></code></pre></div>

<p>In the resulting sequence file, the first 100 positions will have evolved according to <code>model1</code>, and the next 200 positions (there will be a total of 300 positions!) will evolve according to <code>model2</code>.</p>

<p>For more, yes more!, ways to use Pyvolve, check out the (drumroll...) <a href="https://github.com/sjspielman/pyvolve/raw/master/user_manual/pyvolve_manual.pdf">user manual</a>! Please feel free to post any questions and/or file bug reports on Pyvolve&#39;s github repository Issues section. Enjoy!</p>

<p><br><br><br></p>

  </div>
  
</div>



    </div>
    
    <script src="/scripts/responsive.js" type="text/javascript"></script>
  </body>
</html>
